
@{
    ViewBag.Title = "Login";
}

@*<div style="text-align:center">
    <h2>Login</h2>
    <p>Fill out the information below.</p>
    <h3>User id:</h3>
    <input type="email" />
    <br />
    <br />
    <h3>Password:</h3>
    <input type="password" />
    <br />
    <br />
    <input type="button" value="Login" class="btn btn-primary" onclick="location.href='<%: Url.Action("Validate", "UserAuthentication") %>'" />
</div>*@

<div class="container mt-5">
    <h2>Login</h2>
    <form id="loginForm">
        <div class="form-group">
            <label for="username">Username:</label>
            <input type="text" class="form-control" id="username" required>
        </div>
        <div class="form-group">
            <label for="password">Password:</label>
            <input type="password" class="form-control" id="password" required>
        </div>
        <button type="submit" class="btn btn-primary">Login</button>
    </form>

    <div id="result" class="mt-3"></div>
</div>


<script>
    document.getElementById('loginForm').addEventListener('submit', async function (event) {
        event.preventDefault();  // Prevent the form from submitting normally

        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;

        try {
            console.log(username)
            console.log(password)
            var loc = window.location.pathname;
            var dir = loc.substring(0, loc.lastIndexOf('/'));
            console.log(dir)
            const response = await fetch('../../Controllers/UserAuthentication/Validate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ username, password }),
            });

            const result = await response.json();
            document.getElementById('result').innerText = result.message;

            if (result.success) {
                // Redirect to a new page or update the UI on successful login
                window.location.href = "/Home/Index";
            }
        } catch (error) {
            console.error('Error:', error);
            document.getElementById('result').innerText = "An error occurred. Please try again.";
        }
    });
</script>